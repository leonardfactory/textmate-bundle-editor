var fs		= require('fs');
var path	= require('path');
var _		= require('underscore');

module.exports = Folder = function(base_path)
{
	var self = {};
	
	self.base_path = '';
	self.root = [];
	
	self.ALLOWED_TYPES = {
		'tmProperties'  : 'property',
		'tmSnippet'		: 'snippet',
		'tmLanguages'	: 'language'
	}
	
	self.fileType = function(ext)
	{
		return (_.has(self.ALLOWED_TYPES, ext) ? self.ALLOWED_TYPES[ext] : ext); // @todo [icon, ext]
	}
	
	self.FileItem = function (file_path) 
	{
		var fileitem = {};
		
		fileitem = {
			ext		: self.fileType(path.extname(file_path)),
			name	: path.basename(file_path),
			dir		: false
		}
		
		return fileitem;
	}
	
	self.build = function()
	{
		self.base_path = base_path;
		
		var dirs = fs.readdirSync(self.base_path);
		
		dirs.forEach(function(file)
		{
			var file_path = self.base_path + '/' + file;
			var stat = fs.statSync(file_path);
			
			if(stat.isFile()) {
				self.root.push(self.FileItem(file_path));
			}
			else if(stat.isDirectory()) {
				self.root.push(Folder(file_path));
			}
		});
	}
	
	self.build();
	return self.root;
};